
# Table Master

**Table Master** – это веб-приложение на базе Laravel, позволяющее пользователям загружать Excel-файлы и выполнять их конвертацию в различные форматы (XLS, XLSX, CSV, ODS, HTML). Приложение использует асинхронную обработку задач посредством очередей для выполнения конвертаций с использованием библиотек PhpSpreadsheet и OpenSpout.

## Функциональные возможности

### Загрузка файлов

-   Пользователь может загрузить Excel-файл (форматы XLS и XLSX) через веб-интерфейс
-   Загруженный файл сохраняется на локальном диске, а его метаданные – в базе данных

### Конвертация файлов

Приложение поддерживает несколько вариантов конвертации:

-   XLSX → XLS
-   XLS → XLSX (с дополнительной оптимизацией)
-   Excel → ODS
-   Excel → CSV
-   Excel → HTML (одиночный файл либо ZIP-архив для нескольких листов)

Все конвертации выполняются асинхронно с помощью Laravel Job (`ConvertionJob`). После завершения конвертации обновляются статус и путь к результату в базе данных.

### Скачивание результатов

После завершения конвертации пользователь получает возможность скачать преобразованный файл с корректным расширением через `DownloadController`.

### Проверка статуса

Реализована функция периодической проверки статуса конвертации (через AJAX), позволяющая уведомлять пользователя о состоянии задачи.

## Архитектура приложения

### Основные компоненты

**Контроллеры**

-   `FileController` – загрузка и управление файлами (CRUD-операции)
-   `ProcessFileController` – запуск различных задач конвертации (методы вроде `xlsToXlsx`, `excelToCsv` и т.д.)
-   `DownloadController` – скачивание файлов, проверка статуса конвертации

**Job (`ConvertionJob`)**

-   Асинхронное выполнение задач по конвертации файлов
-   В зависимости от типа конвертации вызывается соответствующий метод, обновляющий статус и путь результата в базе данных

**Модель `UserFile`**
Хранит информацию о загруженных файлах, включая:

-   `original_name` – оригинальное имя файла
-   `path` – путь к загруженному файлу
-   `output_path` – путь к файлу после конвертации
-   `status` – текущий статус конвертации (например, processing, completed)

**Очереди (Queues)**

-   Все задачи по конвертации отправляются в очередь Laravel
-   Позволяет обрабатывать задачи асинхронно и не блокировать выполнение HTTP-запросов

**Внешние библиотеки**

-   PhpSpreadsheet
-   OpenSpout

## Установка и настройка

### Требования

-   PHP 7.4+
-   Composer
-   Laravel (версия 8, 9 или 10)
-   Веб-сервер (например, Apache или nginx)
-   Драйвер очереди Laravel (например, database, Redis и т.д.)

### Шаги установки

1. **Клонирование репозитория**

2. **Установка зависимостей через Composer**
    ```bash
    composer install
    ```
3. **Выполните миграции для создания необходимых таблиц**
    ```bash
    php artisan migrate
    ```
4. **Настройка очереди, в отдельном терминале**
    ```bash
    php artisan queue:work
    ```
